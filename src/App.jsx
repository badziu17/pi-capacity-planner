import React, { useState, useMemo, createContext, useContext } from 'react';

const AppContext = createContext();
const useApp = () => useContext(AppContext);

const T = {
  en: { app: { title: 'PI Capacity Planner', subtitle: 'SAFe 6.0 â€¢ Enterprise Edition' }, nav: { capacity: 'Capacity Board', backlog: 'PI Backlog', teams: 'Teams', program: 'Program Board', dashboard: 'RTE Dashboard', whatif: 'What-If', risks: 'Risks', reports: 'Reports & AI', portfolio: 'Portfolio', settings: 'Settings', dependencies: 'Dependencies' }, auth: { signIn: 'Sign In', signOut: 'Sign Out', role: 'Role', demoMode: 'Demo Mode', admin: 'Admin', rte: 'RTE/PM', teamLead: 'Team Lead', member: 'Member', viewer: 'Viewer' }, cap: { title: 'Capacity vs Demand', unplanned: 'Unplanned' }, dash: { title: 'RTE Dashboard', subtitle: 'PI Health Overview', healthScore: 'PI Health Score', totalCapacity: 'Total Capacity', totalDemand: 'Total Demand', avgLoad: 'Avg Load', reserve: 'Reserve', overbooked: 'Overbooked', teamBreakdown: 'Team Breakdown', onTrack: 'On Track' }, deps: { title: 'Dependencies', healthy: 'Healthy', atRisk: 'At Risk', violated: 'Violated', add: 'Add Dependency', provider: 'Provider', consumer: 'Consumer', lowReserve: 'Low reserve', noBuffer: 'No buffer!' }, risks: { title: 'Risks & Confidence', confidence: 'Confidence Vote', avgConfidence: 'Avg Confidence', topRisks: 'Top Risks', addRisk: 'Add Risk', high: 'High', medium: 'Medium', low: 'Low', owner: 'Owner', mitigation: 'Mitigation', resolved: 'Resolved', owned: 'Owned', accepted: 'Accepted', mitigated: 'Mitigated', startVote: 'Start Voting', endVote: 'End Voting' }, reports: { title: 'Reports & AI Forecasts', monteCarlo: 'Monte Carlo Simulation', runSimulation: 'Run Analysis', p50: 'P50', p75: 'P75', p90: 'P90', exportCSV: 'Export CSV', aiTitle: 'AI Velocity Forecast', nextPI: 'Next PI Forecast', confidence: 'Confidence', recommendation: 'Recommendation' }, portfolio: { title: 'Portfolio View', subtitle: 'Multi-ART Capacity', totalCapacity: 'Portfolio Capacity', totalDemand: 'Portfolio Demand', crossART: 'Cross-ART Dependencies', suggestion: 'AI Suggestion', rebalance: 'Rebalance' }, whatif: { title: 'What-If Scenarios', baseline: 'Baseline', scenarioA: 'Scenario A', scenarioB: 'Scenario B' }, settings: { title: 'Settings', integrations: 'Integrations', alerts: 'Alerts', audit: 'Audit Trail', testConnection: 'Test Connection', connected: 'Connected', syncNow: 'Sync Now', autoSync: 'Auto-sync 5min', webhook: 'Webhook URL', testAlert: 'Test Alert' }, teams: { title: 'Teams', velocity: 'Velocity', members: 'Members', absences: 'Absences', holidays: 'Holidays', addTeam: 'Add Team', teamName: 'Team Name' }, backlog: { title: 'PI Backlog', addItem: 'Add', name: 'Name', epic: 'Epic', feature: 'Feature', story: 'Story', enabler: 'Enabler', unassigned: 'Unassigned', status: 'Status', notStarted: 'Not Started', inProgress: 'In Progress', done: 'Done', blocked: 'Blocked', description: 'Description', acceptanceCriteria: 'Acceptance Criteria' }, program: { title: 'Program Board' }, item: { details: 'Item Details', parent: 'Parent', children: 'Children', linkedDeps: 'Dependencies' }, c: { save: 'Save', cancel: 'Cancel', delete: 'Delete', add: 'Add', sp: 'SP', sprint: 'Sprint', team: 'Team', total: 'Total' } },
  pl: { app: { title: 'PI Capacity Planner', subtitle: 'SAFe 6.0 â€¢ Enterprise Edition' }, nav: { capacity: 'Capacity Board', backlog: 'PI Backlog', teams: 'ZespoÅ‚y', program: 'Program Board', dashboard: 'Dashboard RTE', whatif: 'What-If', risks: 'Ryzyka', reports: 'Raporty i AI', portfolio: 'Portfolio', settings: 'Ustawienia', dependencies: 'ZaleÅ¼noÅ›ci' }, auth: { signIn: 'Zaloguj', signOut: 'Wyloguj', role: 'Rola', demoMode: 'Tryb Demo', admin: 'Admin', rte: 'RTE/PM', teamLead: 'Team Lead', member: 'CzÅ‚onek', viewer: 'Obserwator' }, cap: { title: 'Capacity vs Demand', unplanned: 'Nieprzypisane' }, dash: { title: 'Dashboard RTE', subtitle: 'PrzeglÄ…d PI', healthScore: 'Zdrowie PI', totalCapacity: 'CaÅ‚k. Capacity', totalDemand: 'CaÅ‚k. Demand', avgLoad: 'Åšr. Load', reserve: 'Rezerwa', overbooked: 'PrzeciÄ…Å¼one', teamBreakdown: 'ZespoÅ‚y', onTrack: 'OK' }, deps: { title: 'ZaleÅ¼noÅ›ci', healthy: 'OK', atRisk: 'ZagroÅ¼ona', violated: 'Naruszona', add: 'Dodaj zaleÅ¼noÅ›Ä‡', provider: 'Dostawca', consumer: 'Odbiorca', lowReserve: 'MaÅ‚a rezerwa', noBuffer: 'Brak bufora!' }, risks: { title: 'Ryzyka i Confidence', confidence: 'GÅ‚osowanie', avgConfidence: 'Åšr. Confidence', topRisks: 'GÅ‚Ã³wne ryzyka', addRisk: 'Dodaj ryzyko', high: 'Wysoka', medium: 'Åšrednia', low: 'Niska', owner: 'WÅ‚aÅ›ciciel', mitigation: 'Mitygacja', resolved: 'RozwiÄ…zane', owned: 'Z wÅ‚aÅ›cicielem', accepted: 'Zaakceptowane', mitigated: 'Zmitigowane', startVote: 'Rozpocznij', endVote: 'ZakoÅ„cz' }, reports: { title: 'Raporty i prognozy AI', monteCarlo: 'Symulacja Monte Carlo', runSimulation: 'Uruchom analizÄ™', p50: 'P50', p75: 'P75', p90: 'P90', exportCSV: 'Eksport CSV', aiTitle: 'Prognoza AI Velocity', nextPI: 'Prognoza PI', confidence: 'PewnoÅ›Ä‡', recommendation: 'Rekomendacja' }, portfolio: { title: 'Widok Portfolio', subtitle: 'Multi-ART Capacity', totalCapacity: 'Capacity Portfolio', totalDemand: 'Demand Portfolio', crossART: 'ZaleÅ¼noÅ›ci cross-ART', suggestion: 'Sugestia AI', rebalance: 'Rebalansuj' }, whatif: { title: 'Scenariusze What-If', baseline: 'Baseline', scenarioA: 'Scenariusz A', scenarioB: 'Scenariusz B' }, settings: { title: 'Ustawienia', integrations: 'Integracje', alerts: 'Alerty', audit: 'Historia zmian', testConnection: 'Test poÅ‚Ä…czenia', connected: 'PoÅ‚Ä…czono', syncNow: 'Synchronizuj', autoSync: 'Auto-sync 5min', webhook: 'URL Webhook', testAlert: 'Testuj alert' }, teams: { title: 'ZespoÅ‚y', velocity: 'Velocity', members: 'CzÅ‚onkowie', absences: 'NieobecnoÅ›ci', holidays: 'ÅšwiÄ™ta', addTeam: 'Dodaj zespÃ³Å‚', teamName: 'Nazwa' }, backlog: { title: 'PI Backlog', addItem: 'Dodaj', name: 'Nazwa', epic: 'Epic', feature: 'Feature', story: 'Story', enabler: 'Enabler', unassigned: 'Nieprzypisane', status: 'Status', notStarted: 'Nie rozpoczÄ™te', inProgress: 'W trakcie', done: 'ZakoÅ„czone', blocked: 'Zablokowane', description: 'Opis', acceptanceCriteria: 'Kryteria akceptacji' }, program: { title: 'Program Board' }, item: { details: 'SzczegÃ³Å‚y', parent: 'Rodzic', children: 'Dzieci', linkedDeps: 'ZaleÅ¼noÅ›ci' }, c: { save: 'Zapisz', cancel: 'Anuluj', delete: 'UsuÅ„', add: 'Dodaj', sp: 'SP', sprint: 'Sprint', team: 'ZespÃ³Å‚', total: 'Suma' } }
};

const HOLIDAYS_2025 = [{ date: '2025-01-01', name: 'Nowy Rok' }, { date: '2025-01-06', name: 'Trzech KrÃ³li' }, { date: '2025-04-20', name: 'Wielkanoc' }, { date: '2025-04-21', name: 'Pon. Wielk.' }, { date: '2025-05-01', name: 'ÅšwiÄ™to Pracy' }, { date: '2025-05-03', name: '3 Maja' }, { date: '2025-06-08', name: 'Zielone ÅšwiÄ…tki' }, { date: '2025-06-19', name: 'BoÅ¼e CiaÅ‚o' }, { date: '2025-08-15', name: 'WniebowziÄ™cie' }, { date: '2025-11-01', name: 'Wszystkich Åšw.' }, { date: '2025-11-11', name: 'NiepodlegÅ‚oÅ›ci' }, { date: '2025-12-25', name: 'BoÅ¼e Narodzenie' }, { date: '2025-12-26', name: 'Drugi dzieÅ„ Å›wiÄ…t' }];
const PI_CONFIG = { PI44: { name: 'PI 2025.1', start: '2025-02-19', sprints: 5, sprintLength: 10 }, PI45: { name: 'PI 2025.2', start: '2025-04-30', sprints: 5, sprintLength: 10 }, PI46: { name: 'PI 2025.3', start: '2025-07-09', sprints: 5, sprintLength: 10 } };
const ROLES = { admin: { canEdit: true }, rte: { canEdit: true }, teamLead: { canEdit: true }, member: { canEdit: false }, viewer: { canEdit: false } };
const ITEM_TYPES = { epic: { color: '#8b5cf6', label: 'Epic', sizes: [40, 100, 200] }, feature: { color: '#22d3ee', label: 'Feature', sizes: [13, 20, 40] }, story: { color: '#34d399', label: 'Story', sizes: [1, 2, 3, 5, 8, 13] }, enabler: { color: '#f59e0b', label: 'Enabler', sizes: [5, 8, 13, 20] } };

const uid = () => Math.random().toString(36).substr(2, 9);
const parseDate = (s) => new Date(s + 'T00:00:00');
const formatDate = (d) => d.toISOString().split('T')[0];
const isWeekend = (d) => d.getDay() === 0 || d.getDay() === 6;
const isHoliday = (d) => HOLIDAYS_2025.some(h => h.date === formatDate(d));
const getWorkDays = (start, end) => { let c = 0; const cur = new Date(start); while (cur <= end) { if (!isWeekend(cur) && !isHoliday(cur)) c++; cur.setDate(cur.getDate() + 1); } return c; };
const addWorkDays = (start, days) => { const r = new Date(start); let a = 0; while (a < days) { r.setDate(r.getDate() + 1); if (!isWeekend(r) && !isHoliday(r)) a++; } return r; };
const getLoadColor = (load) => load <= 0.8 ? { bg: 'bg-emerald-500/20', border: 'border-emerald-500/50', text: 'text-emerald-400', fill: '#34d399' } : load <= 1.0 ? { bg: 'bg-amber-500/20', border: 'border-amber-500/50', text: 'text-amber-400', fill: '#f59e0b' } : { bg: 'bg-red-500/20', border: 'border-red-500/50', text: 'text-red-400', fill: '#ef4444' };
const calculateSprints = (piConfig) => { const sprints = []; let cur = parseDate(piConfig.start); for (let i = 1; i <= piConfig.sprints; i++) { const end = addWorkDays(cur, piConfig.sprintLength - 1); sprints.push({ num: i, name: i === piConfig.sprints ? 'IP' : `S${i}`, start: new Date(cur), end, workDays: getWorkDays(cur, end), isIP: i === piConfig.sprints }); cur = new Date(end); cur.setDate(cur.getDate() + 1); while (isWeekend(cur)) cur.setDate(cur.getDate() + 1); } return sprints; };

const AIForecastEngine = {
  analyzeVelocityTrend: (data) => { if (!data || data.length < 3) return { trend: 0, forecast: 40, confidence: 0.5, factors: [] }; const n = data.length, yMean = data.reduce((a, b) => a + b, 0) / n; let num = 0, den = 0; data.forEach((y, x) => { num += (x - (n-1)/2) * (y - yMean); den += (x - (n-1)/2) ** 2; }); const slope = den !== 0 ? num / den : 0; const forecast = Math.round(yMean + slope * n); const variance = data.reduce((sum, y) => sum + (y - yMean) ** 2, 0) / n; const stdDev = Math.sqrt(variance); const factors = []; if (slope > 1) factors.push({ type: 'positive', label: 'Improving velocity' }); if (slope < -1) factors.push({ type: 'negative', label: 'Declining velocity' }); return { trend: slope, forecast: Math.max(10, forecast), forecastLow: Math.max(10, Math.round(forecast - stdDev * 1.5)), forecastHigh: Math.round(forecast + stdDev * 1.5), confidence: 0.7, stdDev, factors, recommendation: slope > 0 ? 'Team improving.' : slope < -1 ? 'Declining trend.' : 'Stable velocity.' }; },
  forecastART: (teams) => { const forecasts = teams.map(t => ({ ...t, forecast: AIForecastEngine.analyzeVelocityTrend(t.historicalVelocity) })); const totalForecast = forecasts.reduce((s, t) => s + t.forecast.forecast, 0); return { teamForecasts: forecasts, totalForecast, totalLow: forecasts.reduce((s, t) => s + t.forecast.forecastLow, 0), totalHigh: forecasts.reduce((s, t) => s + t.forecast.forecastHigh, 0), avgConfidence: 0.7, piCapacity: totalForecast * 5, recommendation: 'Plan at P75 with buffer.' }; }
};

const MonteCarloEngine = {
  runSimulation: (teams, items, iterations = 10000) => { const features = items.filter(i => i.type === 'feature' && i.status !== 'done'); const totalSP = features.reduce((s, f) => s + (f.sp || 0), 0); const teamStats = teams.map(t => { const v = t.historicalVelocity || [t.velocity]; const mean = v.reduce((a, b) => a + b, 0) / v.length; return { mean, stdDev: Math.sqrt(v.reduce((s, x) => s + (x - mean) ** 2, 0) / v.length) }; }); const totalMean = teamStats.reduce((s, t) => s + t.mean, 0); const totalStdDev = Math.sqrt(teamStats.reduce((s, t) => s + t.stdDev ** 2, 0)); const results = []; for (let i = 0; i < iterations; i++) { const z = Math.sqrt(-2 * Math.log(Math.random())) * Math.cos(2 * Math.PI * Math.random()); results.push(Math.ceil(totalSP / Math.max(totalMean + z * totalStdDev, totalMean * 0.5))); } results.sort((a, b) => a - b); const histogram = []; const min = Math.min(...results), max = Math.max(...results); const bucketSize = Math.max(1, Math.ceil((max - min + 1) / 15)); for (let i = min; i <= max; i += bucketSize) histogram.push({ sprints: i, count: results.filter(r => r >= i && r < i + bucketSize).length, pct: (results.filter(r => r >= i && r < i + bucketSize).length / iterations) * 100 }); return { totalSP, meanVelocity: totalMean, p50: results[Math.floor(iterations * 0.5)], p75: results[Math.floor(iterations * 0.75)], p90: results[Math.floor(iterations * 0.9)], min: results[0], max: results[results.length - 1], histogram }; },
  generateCSV: (data) => { const { teams, items, simulation, pi, forecast } = data; let csv = `PI Report - ${pi}\n\nMONTE CARLO\nTotal SP,${simulation?.totalSP || 0}\nP50,${simulation?.p50 || 0}\nP75,${simulation?.p75 || 0}\nP90,${simulation?.p90 || 0}\n\nTEAMS\nTeam,Velocity,Load\n`; teams.forEach(t => { const sp = items.filter(i => i.teamId === t.id).reduce((s, i) => s + (i.sp || 0), 0); csv += `${t.name},${t.velocity},${((sp / (t.velocity * 5)) * 100).toFixed(0)}%\n`; }); return csv; }
};

const createDemoData = () => {
  const arts = [{ id: 'art1', name: 'Customer Platform ART', color: '#22d3ee', teamIds: ['team1', 'team2', 'team3'] }, { id: 'art2', name: 'Internal Tools ART', color: '#8b5cf6', teamIds: ['team4', 'team5'] }];
  const teams = [{ id: 'team1', name: 'Team Alpha', color: '#22d3ee', velocity: 40, artId: 'art1', members: [{ id: 'm1', name: 'Anna K.', fte: 1.0 }, { id: 'm2', name: 'Jan N.', fte: 1.0 }], confidence: 4, historicalVelocity: [38, 42, 40, 35, 44, 41, 39, 43] }, { id: 'team2', name: 'Team Beta', color: '#34d399', velocity: 35, artId: 'art1', members: [{ id: 'm3', name: 'Katarzyna L.', fte: 1.0 }], confidence: 3, historicalVelocity: [32, 36, 34, 38, 33, 35, 37, 36] }, { id: 'team3', name: 'Team Gamma', color: '#f59e0b', velocity: 30, artId: 'art1', members: [{ id: 'm4', name: 'Ewa D.', fte: 1.0 }], confidence: 4, historicalVelocity: [28, 32, 30, 29, 31, 30, 33, 31] }, { id: 'team4', name: 'Team Delta', color: '#ec4899', velocity: 25, artId: 'art2', members: [{ id: 'm5', name: 'Krzysztof B.', fte: 1.0 }], confidence: 4, historicalVelocity: [24, 26, 25, 27, 24, 25] }, { id: 'team5', name: 'Team Epsilon', color: '#6366f1', velocity: 28, artId: 'art2', members: [{ id: 'm6', name: 'PaweÅ‚ K.', fte: 1.0 }], confidence: 3, historicalVelocity: [26, 28, 30, 27, 29, 28] }];
  const items = [{ id: 'e1', type: 'epic', name: 'User Management Platform', sp: 0, status: 'inProgress', artId: 'art1' }, { id: 'f1', type: 'feature', name: 'OAuth2 Authentication', sp: 40, teamId: 'team1', sprint: 1, status: 'inProgress', parentId: 'e1' }, { id: 'f2', type: 'feature', name: 'User Profiles', sp: 20, teamId: 'team1', sprint: 2, status: 'notStarted', parentId: 'e1' }, { id: 'f3', type: 'feature', name: 'REST API v1', sp: 48, teamId: 'team2', sprint: 1, status: 'inProgress' }, { id: 'f4', type: 'feature', name: 'Dashboard Charts', sp: 35, teamId: 'team2', sprint: 2, status: 'notStarted' }, { id: 'f5', type: 'feature', name: 'Permission System', sp: 25, teamId: 'team1', sprint: 3, status: 'notStarted', parentId: 'e1' }, { id: 'f6', type: 'feature', name: 'Data Export', sp: 20, teamId: 'team3', sprint: 2, status: 'notStarted' }, { id: 'f7', type: 'feature', name: 'Real-time Updates', sp: 30, teamId: 'team3', sprint: 3, status: 'notStarted' }, { id: 'en1', type: 'enabler', name: 'CI/CD Pipeline', sp: 13, teamId: 'team3', sprint: 1, status: 'done' }, { id: 'f8', type: 'feature', name: 'Admin Panel', sp: 30, teamId: 'team4', sprint: 1, artId: 'art2', status: 'notStarted' }, { id: 'f9', type: 'feature', name: 'Report Generator', sp: 25, teamId: 'team5', sprint: 2, artId: 'art2', status: 'notStarted' }, { id: 'f10', type: 'feature', name: 'Mobile App Shell', sp: 40, status: 'notStarted' }];
  const dependencies = [{ id: 'd1', fromId: 'f3', toId: 'f1', description: 'API needed for OAuth' }, { id: 'd2', fromId: 'f1', toId: 'f5', description: 'Auth before permissions' }, { id: 'd3', fromId: 'f4', toId: 'f6', description: 'Charts for export' }, { id: 'd4', fromId: 'f8', toId: 'f9', description: 'Admin before reports', crossART: true }];
  const risks = [{ id: 'r1', name: 'Third-party API rate limits', severity: 'high', owner: 'Team Beta', status: 'owned', mitigation: 'Implement caching' }, { id: 'r2', name: 'New team member onboarding', severity: 'medium', owner: 'Team Alpha', status: 'mitigated', mitigation: 'Pair programming' }];
  const absences = { 'team1-m1-2': 2, 'team1-m2-3': 5, 'team2-m3-1': 3 };
  const milestones = [{ id: 'ms1', name: 'MVP Release', sprint: 3, color: '#f59e0b' }, { id: 'ms2', name: 'Beta Launch', sprint: 5, color: '#8b5cf6' }];
  const auditLog = [{ id: 'a1', user: 'demo@pi-planner.app', action: 'created', entity: 'Feature', timestamp: new Date().toISOString(), details: 'Created OAuth2' }];
  return { arts, teams, items, dependencies, risks, absences, milestones, auditLog };
};

const Icon = ({ name, className = 'w-5 h-5' }) => { const paths = { capacity: 'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z', backlog: 'M4 6h16M4 10h16M4 14h16M4 18h16', teams: 'M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z', program: 'M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2', dashboard: 'M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z', whatif: 'M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4', risks: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z', reports: 'M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z', portfolio: 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10', settings: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z', plus: 'M12 4v16m8-8H4', x: 'M6 18L18 6M6 6l12 12', check: 'M5 13l4 4L19 7', trash: 'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16', link: 'M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1', sync: 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15', ai: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z', trendUp: 'M13 7h8m0 0v8m0-8l-8 8-4-4-6 6', trendDown: 'M13 17h8m0 0V9m0 8l-8-8-4 4-6-6', download: 'M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4' }; return <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={paths[name] || paths.check} /></svg>; };
const Badge = ({ children, variant = 'default' }) => { const variants = { default: 'bg-slate-700 text-slate-300', success: 'bg-emerald-500/20 text-emerald-400', warning: 'bg-amber-500/20 text-amber-400', danger: 'bg-red-500/20 text-red-400', info: 'bg-cyan-500/20 text-cyan-400', purple: 'bg-purple-500/20 text-purple-400' }; return <span className={`inline-flex items-center rounded-full font-medium px-2 py-0.5 text-xs ${variants[variant]}`}>{children}</span>; };
const TypeBadge = ({ type }) => { const c = ITEM_TYPES[type] || ITEM_TYPES.feature; return <span className="px-2 py-0.5 rounded text-xs font-medium" style={{ backgroundColor: `${c.color}20`, color: c.color }}>{c.label}</span>; };
const StatusBadge = ({ status, t }) => { const colors = { notStarted: 'default', inProgress: 'info', done: 'success', blocked: 'danger' }; return <Badge variant={colors[status] || 'default'}>{t.backlog[status] || status}</Badge>; };
const Modal = ({ open, onClose, title, children, size = 'md' }) => { if (!open) return null; const sizes = { sm: 'max-w-md', md: 'max-w-lg', lg: 'max-w-2xl' }; return <div className="fixed inset-0 z-50 flex items-center justify-center p-4"><div className="absolute inset-0 bg-black/60" onClick={onClose} /><div className={`relative bg-slate-900 border border-slate-700 rounded-2xl w-full ${sizes[size]} max-h-[90vh] overflow-hidden`}><div className="flex items-center justify-between p-4 border-b border-slate-700"><h3 className="text-lg font-semibold text-white">{title}</h3><button onClick={onClose} className="p-1 hover:bg-slate-700 rounded-lg"><Icon name="x" /></button></div><div className="p-4 overflow-y-auto max-h-[calc(90vh-80px)]">{children}</div></div></div>; };
const Stat = ({ label, value, color = 'cyan' }) => { const colors = { cyan: 'text-cyan-400', emerald: 'text-emerald-400', amber: 'text-amber-400', red: 'text-red-400', purple: 'text-purple-400' }; return <div className="bg-slate-900/50 border border-slate-800 rounded-xl p-4"><p className="text-xs text-slate-400 uppercase">{label}</p><p className={`text-2xl font-bold mt-1 ${colors[color]}`}>{value}</p></div>; };

const ItemDetailModal = ({ item, onClose }) => { const { t, items, teams, dependencies, updateItem, userRole } = useApp(); const [editedItem, setEditedItem] = useState({ ...item }); const canEdit = ROLES[userRole]?.canEdit; const team = teams.find(tm => tm.id === item.teamId); const parent = items.find(i => i.id === item.parentId); const children = items.filter(i => i.parentId === item.id); const relatedDeps = dependencies.filter(d => d.fromId === item.id || d.toId === item.id); const handleSave = () => { updateItem(item.id, editedItem); onClose(); }; return <Modal open={true} onClose={onClose} title={t.item.details} size="lg"><div className="space-y-4"><div className="flex items-start gap-4"><TypeBadge type={editedItem.type} /><div className="flex-1">{canEdit ? <input type="text" value={editedItem.name} onChange={e => setEditedItem({ ...editedItem, name: e.target.value })} className="text-xl font-semibold text-white bg-transparent border-none w-full" /> : <h2 className="text-xl font-semibold text-white">{item.name}</h2>}</div><StatusBadge status={editedItem.status} t={t} /></div><div className="grid grid-cols-4 gap-4"><div><label className="block text-xs text-slate-400 mb-1">{t.c.sp}</label>{canEdit ? <select value={editedItem.sp} onChange={e => setEditedItem({ ...editedItem, sp: parseInt(e.target.value) })} className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white">{(ITEM_TYPES[editedItem.type]?.sizes || [1,2,3,5,8,13,20,40]).map(sp => <option key={sp} value={sp}>{sp}</option>)}</select> : <p className="text-white font-medium">{item.sp} SP</p>}</div><div><label className="block text-xs text-slate-400 mb-1">{t.c.team}</label>{canEdit ? <select value={editedItem.teamId || ''} onChange={e => setEditedItem({ ...editedItem, teamId: e.target.value || null })} className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white"><option value="">â€”</option>{teams.map(tm => <option key={tm.id} value={tm.id}>{tm.name}</option>)}</select> : <p className="text-white">{team?.name || 'â€”'}</p>}</div><div><label className="block text-xs text-slate-400 mb-1">{t.c.sprint}</label>{canEdit ? <select value={editedItem.sprint || ''} onChange={e => setEditedItem({ ...editedItem, sprint: e.target.value ? parseInt(e.target.value) : null })} className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white"><option value="">â€”</option>{[1,2,3,4,5].map(s => <option key={s} value={s}>Sprint {s}</option>)}</select> : <p className="text-white">{item.sprint ? `Sprint ${item.sprint}` : 'â€”'}</p>}</div><div><label className="block text-xs text-slate-400 mb-1">{t.backlog.status}</label>{canEdit ? <select value={editedItem.status} onChange={e => setEditedItem({ ...editedItem, status: e.target.value })} className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white">{['notStarted', 'inProgress', 'done', 'blocked'].map(s => <option key={s} value={s}>{t.backlog[s]}</option>)}</select> : <StatusBadge status={item.status} t={t} />}</div></div><div><label className="block text-xs text-slate-400 mb-2">{t.backlog.description}</label>{canEdit ? <textarea value={editedItem.description || ''} onChange={e => setEditedItem({ ...editedItem, description: e.target.value })} rows={3} className="w-full px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white resize-none" /> : <p className="text-slate-300">{item.description || 'â€”'}</p>}</div>{(parent || children.length > 0) && <div className="grid grid-cols-2 gap-4">{parent && <div><label className="block text-xs text-slate-400 mb-2">{t.item.parent}</label><div className="p-2 rounded-lg bg-slate-800/50 flex items-center gap-2"><TypeBadge type={parent.type} /><span className="text-white text-sm">{parent.name}</span></div></div>}{children.length > 0 && <div><label className="block text-xs text-slate-400 mb-2">{t.item.children}</label><div className="space-y-1">{children.map(c => <div key={c.id} className="p-2 rounded-lg bg-slate-800/50 flex items-center gap-2"><TypeBadge type={c.type} /><span className="text-white text-sm">{c.name}</span><Badge>{c.sp} SP</Badge></div>)}</div></div>}</div>}{relatedDeps.length > 0 && <div><label className="block text-xs text-slate-400 mb-2">{t.item.linkedDeps}</label><div className="space-y-2">{relatedDeps.map(dep => { const from = items.find(i => i.id === dep.fromId); const to = items.find(i => i.id === dep.toId); const isProvider = dep.fromId === item.id; return <div key={dep.id} className="p-2 rounded-lg bg-slate-800/50 flex items-center gap-2 text-sm"><Icon name="link" className="w-4 h-4 text-cyan-400" /><span className="text-slate-400">{isProvider ? 'Provides to:' : 'Depends on:'}</span><span className="text-white">{isProvider ? to?.name : from?.name}</span>{dep.crossART && <Badge variant="purple">Cross-ART</Badge>}</div>; })}</div></div>}{canEdit && <div className="flex justify-end gap-3 pt-4 border-t border-slate-700"><button onClick={onClose} className="px-4 py-2 text-slate-400">{t.c.cancel}</button><button onClick={handleSave} className="px-6 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-emerald-500 text-white">{t.c.save}</button></div>}</div></Modal>; };

const AuthScreen = ({ onDemo }) => { const [lang, setLang] = useState('pl'); const [role, setRole] = useState('rte'); const t = T[lang]; return <div className="min-h-screen bg-slate-950 flex items-center justify-center p-4"><div className="bg-slate-900 border border-slate-800 rounded-2xl p-8 w-full max-w-md"><div className="flex items-center justify-center gap-3 mb-8"><div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-cyan-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-cyan-500/20"><span className="text-3xl font-bold text-white">Ï€</span></div><div><h1 className="text-2xl font-bold text-white">{t.app.title}</h1><p className="text-sm text-slate-400">{t.app.subtitle}</p></div></div><div className="flex gap-2 mb-6 justify-center"><button onClick={() => setLang('en')} className={`px-4 py-2 rounded-lg text-sm ${lang === 'en' ? 'bg-cyan-500/20 text-cyan-300' : 'text-slate-400'}`}>English</button><button onClick={() => setLang('pl')} className={`px-4 py-2 rounded-lg text-sm ${lang === 'pl' ? 'bg-cyan-500/20 text-cyan-300' : 'text-slate-400'}`}>Polski</button></div><div className="mb-6"><label className="block text-xs text-slate-400 uppercase mb-2">{t.auth.role}</label><select value={role} onChange={e => setRole(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-slate-800 border border-slate-700 text-white"><option value="admin">{t.auth.admin}</option><option value="rte">{t.auth.rte}</option><option value="teamLead">{t.auth.teamLead}</option><option value="member">{t.auth.member}</option><option value="viewer">{t.auth.viewer}</option></select></div><button onClick={() => onDemo(role, lang)} className="w-full py-4 rounded-xl bg-gradient-to-r from-cyan-500 to-emerald-500 text-white font-semibold text-lg hover:shadow-lg hover:shadow-cyan-500/25 transition-all">{t.auth.demoMode}</button></div></div>; };

const RTEDashboard = () => { const { t, teams, items, sprints } = useApp(); const stats = useMemo(() => { let totalCap = 0, totalDemand = 0, overbookedCount = 0; const teamStats = []; teams.forEach(team => { let teamCap = 0, teamDemand = 0, teamOverbooked = 0; sprints.forEach((sprint, idx) => { const cap = sprint.isIP ? team.velocity * 0.2 : team.velocity; const demand = items.filter(i => i.teamId === team.id && i.sprint === idx + 1).reduce((s, i) => s + (i.sp || 0), 0); teamCap += cap; teamDemand += demand; if (demand > cap) { teamOverbooked++; overbookedCount++; } }); teamStats.push({ ...team, capacity: teamCap, demand: teamDemand, load: teamCap > 0 ? teamDemand / teamCap : 0, overbooked: teamOverbooked }); totalCap += teamCap; totalDemand += teamDemand; }); const avgLoad = totalCap > 0 ? totalDemand / totalCap : 0; const avgConfidence = teams.reduce((s, tm) => s + (tm.confidence || 3), 0) / teams.length; const healthScore = Math.max(0, 100 - (overbookedCount * 10) - ((5 - avgConfidence) * 10)); return { totalCap, totalDemand, avgLoad, reserve: totalCap - totalDemand, overbookedCount, teamStats, avgConfidence, healthScore }; }, [teams, items, sprints]); const alerts = useMemo(() => { const notifs = []; stats.teamStats.forEach(team => { if (team.load > 1) notifs.push({ type: 'danger', title: `ðŸ”´ ${team.name}: Overcommit!`, message: `${(team.load * 100).toFixed(0)}% load` }); else if (team.load > 0.8) notifs.push({ type: 'warning', title: `ðŸŸ¡ ${team.name}: High load`, message: `${(team.load * 100).toFixed(0)}% load` }); }); return notifs; }, [stats]); return <div className="space-y-6"><div className="flex items-center justify-between"><div><h2 className="text-2xl font-bold text-white">{t.dash.title}</h2><p className="text-slate-400">{t.dash.subtitle}</p></div><div className={`px-6 py-3 rounded-2xl ${stats.healthScore >= 70 ? 'bg-emerald-500/20 border-emerald-500/50' : stats.healthScore >= 40 ? 'bg-amber-500/20 border-amber-500/50' : 'bg-red-500/20 border-red-500/50'} border`}><p className="text-xs opacity-70">{t.dash.healthScore}</p><p className={`text-3xl font-bold ${stats.healthScore >= 70 ? 'text-emerald-400' : stats.healthScore >= 40 ? 'text-amber-400' : 'text-red-400'}`}>{stats.healthScore.toFixed(0)}%</p></div></div>{alerts.length > 0 && <div className="space-y-2">{alerts.slice(0, 3).map((alert, i) => <div key={i} className={`p-3 rounded-lg ${alert.type === 'danger' ? 'bg-red-500/20 border border-red-500/50' : 'bg-amber-500/20 border border-amber-500/50'}`}><p className={alert.type === 'danger' ? 'text-red-400' : 'text-amber-400'}>{alert.title}</p><p className="text-sm text-slate-300">{alert.message}</p></div>)}</div>}<div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"><Stat label={t.dash.totalCapacity} value={`${stats.totalCap} SP`} color="cyan" /><Stat label={t.dash.totalDemand} value={`${stats.totalDemand} SP`} color="purple" /><Stat label={t.dash.avgLoad} value={`${(stats.avgLoad * 100).toFixed(0)}%`} color={stats.avgLoad > 1 ? 'red' : stats.avgLoad > 0.8 ? 'amber' : 'emerald'} /><Stat label={t.dash.reserve} value={`${stats.reserve} SP`} color={stats.reserve < 0 ? 'red' : 'emerald'} /><Stat label={t.dash.overbooked} value={stats.overbookedCount} color={stats.overbookedCount > 0 ? 'red' : 'emerald'} /><Stat label={t.risks.avgConfidence} value={`${stats.avgConfidence.toFixed(1)}/5`} color={stats.avgConfidence >= 3.5 ? 'emerald' : 'amber'} /></div><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><h3 className="font-semibold text-white mb-4">{t.dash.teamBreakdown}</h3><div className="space-y-4">{stats.teamStats.map(team => { const color = getLoadColor(team.load); return <div key={team.id} className="flex items-center gap-4"><div className="w-28 flex items-center gap-2"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: team.color }} /><span className="text-white text-sm">{team.name}</span></div><div className="flex-1"><div className="h-6 bg-slate-800 rounded-full overflow-hidden relative"><div className="h-full rounded-full" style={{ width: `${Math.min(team.load * 100, 100)}%`, backgroundColor: color.fill }} /><div className="absolute inset-0 flex items-center justify-between px-3"><span className="text-xs text-white">{team.demand}/{team.capacity} SP</span><span className={`text-xs font-bold ${color.text}`}>{(team.load * 100).toFixed(0)}%</span></div></div></div><div className="w-24">{team.overbooked > 0 ? <Badge variant="danger">{team.overbooked} over</Badge> : <Badge variant="success">{t.dash.onTrack}</Badge>}</div></div>; })}</div></div></div>; };

const CapacityBoard = () => { const { t, teams, items, sprints, absences, updateItem, setSelectedItem } = useApp(); const [draggedItem, setDraggedItem] = useState(null); const capacityData = useMemo(() => { const data = {}; teams.forEach(team => { data[team.id] = {}; sprints.forEach((sprint, idx) => { const sprintNum = idx + 1; let effectiveDays = 0; team.members?.forEach(member => { const absKey = `${team.id}-${member.id}-${sprintNum}`; const absDays = absences[absKey] || 0; effectiveDays += (sprint.workDays - absDays) * member.fte; }); const baseCap = sprint.isIP ? team.velocity * 0.2 : team.velocity; const cap = team.members?.length > 0 ? Math.round(baseCap * (effectiveDays / (sprint.workDays * team.members.length))) : baseCap; const demand = items.filter(i => i.teamId === team.id && i.sprint === sprintNum).reduce((s, i) => s + (i.sp || 0), 0); data[team.id][sprintNum] = { capacity: cap, demand, load: cap > 0 ? demand / cap : 0, items: items.filter(i => i.teamId === team.id && i.sprint === sprintNum) }; }); }); return data; }, [teams, items, sprints, absences]); const unassigned = items.filter(i => (!i.teamId || !i.sprint) && i.type !== 'epic'); return <div className="space-y-6"><h2 className="text-2xl font-bold text-white">{t.cap.title}</h2><div className="bg-slate-900/50 border border-slate-800 rounded-2xl overflow-x-auto"><table className="w-full min-w-[900px]"><thead><tr className="bg-slate-900"><th className="px-4 py-3 text-left text-xs text-slate-400 uppercase w-44 sticky left-0 bg-slate-900 z-10">{t.c.team}</th>{sprints.map((s, i) => <th key={i} className="px-2 py-3 text-center text-xs text-slate-400 uppercase min-w-[140px]"><span className={s.isIP ? 'text-purple-400' : ''}>{s.name}</span></th>)}<th className="px-4 py-3 text-center text-xs text-slate-400 uppercase w-28">{t.c.total}</th></tr></thead><tbody className="divide-y divide-slate-800">{teams.map(team => { const teamTotal = { cap: 0, demand: 0 }; return <tr key={team.id}><td className="px-4 py-3 sticky left-0 bg-slate-900/95 z-10"><div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: team.color }} /><div><span className="text-white font-medium">{team.name}</span><p className="text-xs text-slate-500">{team.velocity} SP</p></div></div></td>{sprints.map((sprint, idx) => { const cell = capacityData[team.id]?.[idx + 1] || { capacity: 0, demand: 0, load: 0, items: [] }; teamTotal.cap += cell.capacity; teamTotal.demand += cell.demand; const color = getLoadColor(cell.load); return <td key={idx} className="px-2 py-2" onDragOver={e => e.preventDefault()} onDrop={() => { if (draggedItem) { updateItem(draggedItem.id, { teamId: team.id, sprint: idx + 1 }); setDraggedItem(null); } }}><div className={`p-2 rounded-xl ${color.bg} ${color.border} border min-h-[100px] transition-all ${draggedItem ? 'ring-2 ring-cyan-500/30' : ''}`}><div className="flex justify-between text-sm mb-1"><span className={`font-bold ${color.text}`}>{cell.demand}/{cell.capacity}</span><span className={color.text}>{(cell.load * 100).toFixed(0)}%</span></div><div className="h-1.5 bg-slate-800 rounded-full overflow-hidden mb-2"><div className="h-full rounded-full" style={{ width: `${Math.min(cell.load * 100, 100)}%`, backgroundColor: color.fill }} /></div><div className="space-y-1">{cell.items.map(item => <div key={item.id} draggable onDragStart={() => setDraggedItem(item)} onClick={() => setSelectedItem(item)} className="p-1.5 rounded bg-slate-800/60 hover:bg-slate-700/60 cursor-pointer flex items-center gap-1"><div className="w-1.5 h-1.5 rounded-full" style={{ backgroundColor: ITEM_TYPES[item.type]?.color }} /><span className="text-xs text-white truncate flex-1">{item.name}</span><span className="text-xs text-slate-400">{item.sp}</span></div>)}</div></div></td>; })}<td className="px-4 py-3"><div className={`p-2 rounded-xl text-center ${getLoadColor(teamTotal.cap > 0 ? teamTotal.demand / teamTotal.cap : 0).bg}`}><p className={`font-bold ${getLoadColor(teamTotal.cap > 0 ? teamTotal.demand / teamTotal.cap : 0).text}`}>{teamTotal.demand}/{teamTotal.cap}</p></div></td></tr>; })}</tbody></table></div><div className="bg-slate-900/50 border border-slate-800 rounded-xl p-4"><h3 className="text-sm font-medium text-slate-400 mb-3">{t.cap.unplanned} ({unassigned.length})</h3><div className="flex flex-wrap gap-2">{unassigned.map(item => <div key={item.id} draggable onDragStart={() => setDraggedItem(item)} onClick={() => setSelectedItem(item)} className="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 cursor-pointer flex items-center gap-2"><TypeBadge type={item.type} /><span className="text-white text-sm">{item.name}</span><Badge variant="info">{item.sp} SP</Badge></div>)}{unassigned.length === 0 && <p className="text-slate-500 text-sm">âœ“ All assigned</p>}</div></div></div>; };

const BacklogView = () => { const { t, items, teams, addItem, deleteItem, userRole, setSelectedItem } = useApp(); const [newItem, setNewItem] = useState({ type: 'feature', name: '', sp: 20 }); const [filter, setFilter] = useState('all'); const canEdit = ROLES[userRole]?.canEdit; const filteredItems = filter === 'all' ? items : filter === 'unassigned' ? items.filter(i => !i.teamId) : items.filter(i => i.type === filter); const handleAdd = () => { if (!newItem.name) return; addItem({ ...newItem, id: uid(), status: 'notStarted' }); setNewItem({ type: 'feature', name: '', sp: 20 }); }; return <div className="space-y-6"><h2 className="text-2xl font-bold text-white">{t.backlog.title}</h2>{canEdit && <div className="bg-slate-900/50 border border-slate-800 rounded-xl p-4 flex gap-2 flex-wrap"><select value={newItem.type} onChange={e => setNewItem({ ...newItem, type: e.target.value, sp: ITEM_TYPES[e.target.value]?.sizes?.[1] || 20 })} className="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm">{Object.entries(ITEM_TYPES).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}</select><input type="text" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} onKeyDown={e => e.key === 'Enter' && handleAdd()} placeholder={t.backlog.name} className="flex-1 min-w-[200px] px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white" /><select value={newItem.sp} onChange={e => setNewItem({ ...newItem, sp: parseInt(e.target.value) })} className="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm w-24">{(ITEM_TYPES[newItem.type]?.sizes || [1,2,3,5,8,13,20,40]).map(sp => <option key={sp} value={sp}>{sp} SP</option>)}</select><button onClick={handleAdd} className="px-4 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-emerald-500 text-white"><Icon name="plus" className="w-5 h-5" /></button></div>}<div className="flex gap-2 flex-wrap">{['all', 'unassigned', 'epic', 'feature', 'story', 'enabler'].map(f => <button key={f} onClick={() => setFilter(f)} className={`px-3 py-1.5 rounded-lg text-sm ${filter === f ? 'bg-cyan-500/20 text-cyan-300' : 'text-slate-400 hover:text-white'}`}>{f === 'all' ? 'All' : f === 'unassigned' ? t.backlog.unassigned : ITEM_TYPES[f]?.label || f}</button>)}</div><div className="bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden"><table className="w-full"><thead><tr className="bg-slate-900 text-xs uppercase text-slate-400"><th className="px-4 py-3 text-left">Type</th><th className="px-4 py-3 text-left">{t.backlog.name}</th><th className="px-4 py-3 text-center">{t.c.sp}</th><th className="px-4 py-3 text-center">{t.backlog.status}</th><th className="px-4 py-3 text-center">{t.c.team}</th><th className="px-4 py-3 text-center">{t.c.sprint}</th><th className="px-4 py-3"></th></tr></thead><tbody className="divide-y divide-slate-800">{filteredItems.map(item => <tr key={item.id} onClick={() => setSelectedItem(item)} className="hover:bg-slate-800/30 cursor-pointer"><td className="px-4 py-3"><TypeBadge type={item.type} /></td><td className="px-4 py-3 text-white font-medium">{item.name}</td><td className="px-4 py-3 text-center"><Badge variant="info">{item.sp}</Badge></td><td className="px-4 py-3 text-center"><StatusBadge status={item.status} t={t} /></td><td className="px-4 py-3 text-center">{teams.find(tm => tm.id === item.teamId)?.name || 'â€”'}</td><td className="px-4 py-3 text-center">{item.sprint ? `S${item.sprint}` : 'â€”'}</td><td className="px-4 py-3 text-center" onClick={e => e.stopPropagation()}>{canEdit && <button onClick={() => deleteItem(item.id)} className="p-1 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400"><Icon name="trash" className="w-4 h-4" /></button>}</td></tr>)}</tbody></table></div></div>; };

const TeamsView = () => { const { t, teams, sprints, absences, updateTeam, addTeam, deleteTeam, updateAbsence, userRole } = useApp(); const [newTeam, setNewTeam] = useState({ name: '', color: '#22d3ee', velocity: 40 }); const canEdit = ROLES[userRole]?.canEdit; return <div className="space-y-6"><h2 className="text-2xl font-bold text-white">{t.teams.title}</h2><div className="bg-slate-900/50 border border-slate-800 rounded-xl p-4"><h3 className="text-sm font-medium text-slate-400 mb-2">{t.teams.holidays} 2025</h3><div className="flex flex-wrap gap-2">{HOLIDAYS_2025.map((h, i) => <span key={i} className="px-2 py-1 rounded bg-amber-500/10 text-amber-400 text-xs">{h.date.slice(5)} {h.name}</span>)}</div></div>{teams.map(team => <div key={team.id} className="bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden"><div className="p-4 border-b border-slate-800 flex items-center gap-4"><input type="color" value={team.color} onChange={e => canEdit && updateTeam(team.id, { color: e.target.value })} disabled={!canEdit} className="w-10 h-10 rounded-lg" /><input type="text" value={team.name} onChange={e => canEdit && updateTeam(team.id, { name: e.target.value })} disabled={!canEdit} className="text-lg font-semibold text-white bg-transparent border-none flex-1" /><div className="flex items-center gap-2"><span className="text-slate-400 text-sm">{t.teams.velocity}:</span><input type="number" value={team.velocity} onChange={e => canEdit && updateTeam(team.id, { velocity: parseInt(e.target.value) })} disabled={!canEdit} className="w-20 px-3 py-1 rounded-lg bg-slate-800 border border-slate-700 text-white text-center" /></div>{canEdit && <button onClick={() => deleteTeam(team.id)} className="p-2 hover:bg-red-500/20 rounded-lg text-slate-400 hover:text-red-400"><Icon name="trash" /></button>}</div><div className="p-4"><h4 className="text-sm text-slate-400 mb-2">{t.teams.absences}</h4><table className="w-full text-sm"><thead><tr className="text-slate-400"><th className="text-left py-1 w-40">Member</th><th className="text-center py-1 w-16">FTE</th>{sprints.map((s, i) => <th key={i} className="text-center py-1 w-16">{s.name}</th>)}</tr></thead><tbody>{team.members?.map(m => <tr key={m.id}><td className="py-1 text-white">{m.name}</td><td className="py-1 text-center text-slate-400">{m.fte}</td>{sprints.map((s, i) => <td key={i} className="text-center py-1"><input type="number" value={absences[`${team.id}-${m.id}-${i + 1}`] || 0} onChange={e => canEdit && updateAbsence(team.id, m.id, i + 1, parseInt(e.target.value) || 0)} disabled={!canEdit} min="0" max={s.workDays} className="w-12 px-2 py-1 rounded bg-slate-800 text-white text-center text-sm border border-slate-700" /></td>)}</tr>)}</tbody></table></div></div>)}{canEdit && <div className="bg-slate-900/50 border border-slate-800 rounded-xl p-4 flex gap-2"><input type="text" value={newTeam.name} onChange={e => setNewTeam({ ...newTeam, name: e.target.value })} placeholder={t.teams.teamName} className="flex-1 px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white" /><input type="color" value={newTeam.color} onChange={e => setNewTeam({ ...newTeam, color: e.target.value })} className="w-10 h-10 rounded-lg" /><input type="number" value={newTeam.velocity} onChange={e => setNewTeam({ ...newTeam, velocity: parseInt(e.target.value) })} className="w-20 px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-center" /><button onClick={() => { if (newTeam.name) { addTeam({ ...newTeam, id: uid(), members: [], confidence: 3, historicalVelocity: [newTeam.velocity] }); setNewTeam({ name: '', color: '#22d3ee', velocity: 40 }); } }} className="px-4 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-emerald-500 text-white">{t.c.add}</button></div>}</div>; };

const ProgramBoard = () => { const { t, teams, items, sprints, milestones, dependencies, setSelectedItem } = useApp(); const features = items.filter(i => i.type === 'feature' || i.type === 'enabler'); return <div className="space-y-6"><h2 className="text-2xl font-bold text-white">{t.program.title}</h2><div className="bg-slate-900/50 border border-slate-800 rounded-2xl overflow-x-auto"><div className="min-w-[900px]"><div className="flex border-b border-slate-700"><div className="w-36 shrink-0 p-3 bg-slate-900" />{sprints.map((s, i) => <div key={i} className="flex-1 min-w-[140px] p-3 text-center border-l border-slate-700"><p className={`font-semibold ${s.isIP ? 'text-purple-400' : 'text-white'}`}>{s.name}</p><div className="flex flex-wrap justify-center gap-1 mt-1">{milestones.filter(m => m.sprint === i + 1).map(m => <span key={m.id} className="px-2 py-0.5 rounded text-xs" style={{ backgroundColor: `${m.color}20`, color: m.color }}>â—† {m.name}</span>)}</div></div>)}</div>{teams.map(team => <div key={team.id} className="flex border-b border-slate-700"><div className="w-36 shrink-0 p-3 bg-slate-900/50 flex items-center gap-2"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: team.color }} /><span className="text-white text-sm">{team.name}</span></div>{sprints.map((s, i) => { const sprintItems = features.filter(f => f.teamId === team.id && f.sprint === i + 1); return <div key={i} className="flex-1 min-w-[140px] p-2 border-l border-slate-700">{sprintItems.map(item => { const hasDep = dependencies.some(d => d.fromId === item.id || d.toId === item.id); return <div key={item.id} onClick={() => setSelectedItem(item)} className={`p-2 mb-1 rounded text-xs cursor-pointer hover:bg-slate-700/50 ${hasDep ? 'bg-cyan-500/10 border border-cyan-500/30' : 'bg-slate-800/50'}`}>{hasDep && <span className="text-cyan-400 mr-1">â›“</span>}<span className="text-white">{item.name}</span><span className="text-slate-400 ml-1">{item.sp}</span></div>; })}</div>; })}</div>)}</div></div></div>; };

const DependenciesView = () => { const { t, teams, items, dependencies, addDependency, deleteDependency, setSelectedItem } = useApp(); const [showAdd, setShowAdd] = useState(false); const [newDep, setNewDep] = useState({ fromId: '', toId: '', description: '' }); const features = items.filter(i => i.type === 'feature' || i.type === 'enabler'); const analyzed = dependencies.map(dep => { const from = items.find(i => i.id === dep.fromId); const to = items.find(i => i.id === dep.toId); let status = 'healthy'; if (from?.sprint >= to?.sprint && from?.sprint && to?.sprint) status = 'violated'; else if (from?.sprint === to?.sprint - 1) status = 'atRisk'; return { ...dep, from, to, fromTeam: teams.find(tm => tm.id === from?.teamId), toTeam: teams.find(tm => tm.id === to?.teamId), status }; }); return <div className="space-y-6"><div className="flex items-center justify-between"><h2 className="text-2xl font-bold text-white">{t.deps.title}</h2><button onClick={() => setShowAdd(true)} className="px-4 py-2 rounded-xl bg-gradient-to-r from-cyan-500 to-emerald-500 text-white flex items-center gap-2"><Icon name="plus" className="w-5 h-5" /> {t.deps.add}</button></div><div className="grid grid-cols-3 gap-4"><div className="bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4"><p className="text-xs text-emerald-400 uppercase">{t.deps.healthy}</p><p className="text-2xl font-bold text-emerald-400">{analyzed.filter(d => d.status === 'healthy').length}</p></div><div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4"><p className="text-xs text-amber-400 uppercase">{t.deps.atRisk}</p><p className="text-2xl font-bold text-amber-400">{analyzed.filter(d => d.status === 'atRisk').length}</p></div><div className="bg-red-500/10 border border-red-500/30 rounded-xl p-4"><p className="text-xs text-red-400 uppercase">{t.deps.violated}</p><p className="text-2xl font-bold text-red-400">{analyzed.filter(d => d.status === 'violated').length}</p></div></div><div className="bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden"><table className="w-full"><thead><tr className="bg-slate-900 text-xs uppercase text-slate-400"><th className="px-4 py-3 text-left">{t.deps.provider}</th><th className="px-4 py-3 text-center">â†’</th><th className="px-4 py-3 text-left">{t.deps.consumer}</th><th className="px-4 py-3 text-center">Status</th><th className="px-4 py-3"></th></tr></thead><tbody className="divide-y divide-slate-800">{analyzed.map(dep => <tr key={dep.id} className={dep.status === 'violated' ? 'bg-red-500/5' : dep.status === 'atRisk' ? 'bg-amber-500/5' : ''}><td className="px-4 py-3 cursor-pointer" onClick={() => setSelectedItem(dep.from)}><div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full" style={{ backgroundColor: dep.fromTeam?.color }} /><div><p className="text-white text-sm">{dep.from?.name}</p><p className="text-xs text-slate-400">{dep.fromTeam?.name} â€¢ S{dep.from?.sprint}</p></div></div></td><td className="px-4 py-3 text-center text-slate-400">â†’</td><td className="px-4 py-3 cursor-pointer" onClick={() => setSelectedItem(dep.to)}><div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full" style={{ backgroundColor: dep.toTeam?.color }} /><div><p className="text-white text-sm">{dep.to?.name}</p><p className="text-xs text-slate-400">{dep.toTeam?.name} â€¢ S{dep.to?.sprint}</p></div></div></td><td className="px-4 py-3 text-center"><Badge variant={dep.status === 'healthy' ? 'success' : dep.status === 'atRisk' ? 'warning' : 'danger'}>{t.deps[dep.status]}</Badge></td><td className="px-4 py-3"><button onClick={() => deleteDependency(dep.id)} className="p-1 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400"><Icon name="trash" className="w-4 h-4" /></button></td></tr>)}</tbody></table></div><Modal open={showAdd} onClose={() => setShowAdd(false)} title={t.deps.add}><div className="space-y-4"><div><label className="block text-xs text-slate-400 mb-1">{t.deps.provider}</label><select value={newDep.fromId} onChange={e => setNewDep({ ...newDep, fromId: e.target.value })} className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white"><option value="">Select...</option>{features.filter(f => f.teamId && f.sprint).map(f => <option key={f.id} value={f.id}>{f.name} ({teams.find(tm => tm.id === f.teamId)?.name} S{f.sprint})</option>)}</select></div><div><label className="block text-xs text-slate-400 mb-1">{t.deps.consumer}</label><select value={newDep.toId} onChange={e => setNewDep({ ...newDep, toId: e.target.value })} className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white"><option value="">Select...</option>{features.filter(f => f.teamId && f.sprint).map(f => <option key={f.id} value={f.id}>{f.name} ({teams.find(tm => tm.id === f.teamId)?.name} S{f.sprint})</option>)}</select></div><div className="flex justify-end gap-3 pt-4"><button onClick={() => setShowAdd(false)} className="px-4 py-2 text-slate-400">{t.c.cancel}</button><button onClick={() => { if (newDep.fromId && newDep.toId) { addDependency({ ...newDep, id: uid() }); setNewDep({ fromId: '', toId: '', description: '' }); setShowAdd(false); } }} className="px-6 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-emerald-500 text-white">{t.c.add}</button></div></div></Modal></div>; };

const WhatIfView = () => { const { t, teams, items, sprints } = useApp(); const [scenarios] = useState([{ id: 'baseline', name: t.whatif.baseline, adjustments: [], isBaseline: true }, { id: 'a', name: t.whatif.scenarioA, adjustments: [{ type: 'reduceCapacity', teamId: 'team2', value: 20 }] }, { id: 'b', name: t.whatif.scenarioB, adjustments: [{ type: 'addTeam', name: 'Team Delta+', velocity: 25 }] }]); const calculate = (scenario) => { let sTeams = [...teams]; scenario.adjustments.forEach(adj => { if (adj.type === 'reduceCapacity') sTeams = sTeams.map(tm => tm.id === adj.teamId ? { ...tm, velocity: Math.round(tm.velocity * (1 - adj.value / 100)) } : tm); else if (adj.type === 'addTeam') sTeams = [...sTeams, { id: uid(), name: adj.name, velocity: adj.velocity, members: [] }]; }); let cap = 0, demand = 0, over = 0; sTeams.forEach(team => sprints.forEach((sp, idx) => { const c = sp.isIP ? team.velocity * 0.2 : team.velocity; const d = items.filter(i => i.teamId === team.id && i.sprint === idx + 1).reduce((s, i) => s + (i.sp || 0), 0); cap += c; demand += d; if (d > c) over++; })); return { cap, demand, load: cap > 0 ? demand / cap : 0, over, reserve: cap - demand }; }; const results = scenarios.map(s => ({ ...s, r: calculate(s) })); const baseline = results.find(s => s.isBaseline)?.r || { cap: 0, demand: 0, load: 0, over: 0, reserve: 0 }; return <div className="space-y-6"><h2 className="text-2xl font-bold text-white">{t.whatif.title}</h2><div className="grid grid-cols-1 md:grid-cols-3 gap-6">{results.map(s => { const delta = { load: ((s.r.load - baseline.load) * 100).toFixed(1), reserve: s.r.reserve - baseline.reserve }; const color = getLoadColor(s.r.load); return <div key={s.id} className={`bg-slate-900/50 border rounded-2xl overflow-hidden ${s.isBaseline ? 'border-cyan-500/50' : 'border-slate-700'}`}><div className={`p-4 border-b border-slate-700 ${s.isBaseline ? 'bg-cyan-500/10' : ''}`}><h3 className="font-semibold text-white">{s.name}</h3>{s.adjustments.map((adj, i) => <p key={i} className="text-xs text-slate-400">â€¢ {adj.type === 'reduceCapacity' ? `${teams.find(tm => tm.id === adj.teamId)?.name}: -${adj.value}%` : `Add ${adj.name}`}</p>)}</div><div className="p-4 space-y-4"><div className={`p-3 rounded-xl ${color.bg} ${color.border} border`}><div className="flex justify-between"><span className="text-slate-300">Load</span><span className={`font-bold ${color.text}`}>{(s.r.load * 100).toFixed(0)}%</span></div>{!s.isBaseline && <p className={`text-xs ${parseFloat(delta.load) <= 0 ? 'text-emerald-400' : 'text-red-400'}`}>{delta.load > 0 ? '+' : ''}{delta.load}%</p>}</div><div className="flex justify-between text-sm"><div><p className="text-slate-400">Reserve</p><p className={`font-bold ${s.r.reserve >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>{s.r.reserve} SP</p></div><div className="text-right"><p className="text-slate-400">Overbooked</p><p className={`font-bold ${s.r.over === 0 ? 'text-emerald-400' : 'text-red-400'}`}>{s.r.over}</p></div></div></div></div>; })}</div></div>; };

const RisksView = () => { const { t, teams, risks, addRisk, updateRisk, deleteRisk, updateTeam, userRole } = useApp(); const [votingActive, setVotingActive] = useState(false); const [newRisk, setNewRisk] = useState({ name: '', severity: 'medium', owner: '', status: 'owned' }); const canEdit = ROLES[userRole]?.canEdit; const avgConf = teams.reduce((s, tm) => s + (tm.confidence || 3), 0) / teams.length; return <div className="space-y-6"><div className="flex items-center justify-between"><h2 className="text-2xl font-bold text-white">{t.risks.title}</h2>{canEdit && <button onClick={() => setVotingActive(!votingActive)} className={`px-4 py-2 rounded-xl ${votingActive ? 'bg-amber-500/20 text-amber-400' : 'bg-slate-800 text-slate-300'}`}>{votingActive ? t.risks.endVote : t.risks.startVote}</button>}</div><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><div className="flex items-center justify-between mb-4"><h3 className="font-semibold text-white">{t.risks.confidence}</h3><div className={`px-4 py-2 rounded-xl ${avgConf >= 3.5 ? 'bg-emerald-500/20' : 'bg-amber-500/20'}`}><span className={`text-xl font-bold ${avgConf >= 3.5 ? 'text-emerald-400' : 'text-amber-400'}`}>{avgConf.toFixed(1)}/5</span></div></div><div className="grid grid-cols-3 gap-4">{teams.map(team => <div key={team.id} className="p-4 rounded-xl bg-slate-800/50"><div className="flex items-center gap-2 mb-3"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: team.color }} /><span className="text-white">{team.name}</span></div><div className="flex justify-center gap-2">{[1, 2, 3, 4, 5].map(v => <button key={v} onClick={() => votingActive && canEdit && updateTeam(team.id, { confidence: v })} disabled={!votingActive || !canEdit} className={`w-10 h-10 rounded-lg font-bold ${team.confidence === v ? (v <= 2 ? 'bg-red-500' : v === 3 ? 'bg-amber-500' : 'bg-emerald-500') + ' text-white' : 'bg-slate-700 text-slate-400'}`}>{v}</button>)}</div></div>)}</div></div><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><h3 className="font-semibold text-white mb-4">{t.risks.topRisks}</h3><div className="space-y-3">{risks.map(risk => <div key={risk.id} className={`p-4 rounded-xl border ${risk.severity === 'high' ? 'bg-red-500/10 border-red-500/30' : risk.severity === 'medium' ? 'bg-amber-500/10 border-amber-500/30' : 'bg-slate-800/50 border-slate-700'}`}><div className="flex items-start justify-between"><div><div className="flex items-center gap-2 mb-1"><Badge variant={risk.severity === 'high' ? 'danger' : risk.severity === 'medium' ? 'warning' : 'default'}>{t.risks[risk.severity]}</Badge><Badge variant={risk.status === 'resolved' ? 'success' : 'default'}>{t.risks[risk.status]}</Badge></div><p className="text-white">{risk.name}</p><p className="text-sm text-slate-400 mt-1">{t.risks.owner}: {risk.owner}</p></div>{canEdit && <div className="flex gap-1"><select value={risk.status} onChange={e => updateRisk(risk.id, { status: e.target.value })} className="px-2 py-1 rounded bg-slate-700 text-white text-xs border-none">{['owned', 'accepted', 'mitigated', 'resolved'].map(s => <option key={s} value={s}>{t.risks[s]}</option>)}</select><button onClick={() => deleteRisk(risk.id)} className="p-1 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400"><Icon name="trash" className="w-4 h-4" /></button></div>}</div></div>)}</div>{canEdit && <div className="mt-4 p-4 rounded-xl bg-slate-800/50 space-y-2"><input type="text" value={newRisk.name} onChange={e => setNewRisk({ ...newRisk, name: e.target.value })} placeholder="Risk description" className="w-full px-3 py-2 rounded-lg bg-slate-700 text-white text-sm border border-slate-600" /><div className="flex gap-2"><select value={newRisk.severity} onChange={e => setNewRisk({ ...newRisk, severity: e.target.value })} className="px-3 py-2 rounded-lg bg-slate-700 text-white text-sm">{['high', 'medium', 'low'].map(s => <option key={s} value={s}>{t.risks[s]}</option>)}</select><input type="text" value={newRisk.owner} onChange={e => setNewRisk({ ...newRisk, owner: e.target.value })} placeholder="Owner" className="flex-1 px-3 py-2 rounded-lg bg-slate-700 text-white text-sm border border-slate-600" /><button onClick={() => { if (newRisk.name) { addRisk({ ...newRisk, id: uid() }); setNewRisk({ name: '', severity: 'medium', owner: '', status: 'owned' }); } }} className="px-4 py-2 rounded-lg bg-cyan-500/20 text-cyan-400">{t.c.add}</button></div></div>}</div></div>; };

const ReportsView = () => { const { t, teams, items, pi } = useApp(); const [simulation, setSimulation] = useState(null); const [forecast, setForecast] = useState(null); const [running, setRunning] = useState(false); const runAll = async () => { setRunning(true); await new Promise(r => setTimeout(r, 100)); const sim = MonteCarloEngine.runSimulation(teams, items, 10000); const fc = AIForecastEngine.forecastART(teams); setSimulation(sim); setForecast(fc); setRunning(false); }; const exportCSV = () => { if (!simulation) return; const csv = MonteCarloEngine.generateCSV({ teams, items, simulation, pi, forecast }); const blob = new Blob([csv], { type: 'text/csv' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `pi-report-${pi}.csv`; a.click(); }; return <div className="space-y-6"><div className="flex items-center justify-between"><div><h2 className="text-2xl font-bold text-white">{t.reports.title}</h2></div><div className="flex gap-2"><button onClick={exportCSV} disabled={!simulation} className="px-4 py-2 rounded-lg bg-slate-800 text-white text-sm disabled:opacity-50 flex items-center gap-2"><Icon name="download" className="w-4 h-4" />{t.reports.exportCSV}</button><button onClick={runAll} disabled={running} className="px-4 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-emerald-500 text-white text-sm disabled:opacity-50 flex items-center gap-2"><Icon name="ai" className="w-4 h-4" />{running ? '...' : t.reports.runSimulation}</button></div></div><div className="bg-gradient-to-br from-purple-500/10 to-cyan-500/10 border border-purple-500/30 rounded-2xl p-6"><h3 className="font-semibold text-white mb-4 flex items-center gap-2"><Icon name="ai" className="w-5 h-5 text-purple-400" />{t.reports.aiTitle}</h3>{forecast ? <div className="space-y-4"><div className="grid grid-cols-4 gap-4"><Stat label={t.reports.nextPI} value={`${forecast.totalForecast} SP`} color="purple" /><Stat label="Range" value={`${forecast.totalLow}-${forecast.totalHigh}`} color="cyan" /><Stat label={t.reports.confidence} value={`${(forecast.avgConfidence * 100).toFixed(0)}%`} color={forecast.avgConfidence > 0.7 ? 'emerald' : 'amber'} /><Stat label="PI Capacity" value={`${forecast.piCapacity} SP`} color="cyan" /></div><div className="p-4 rounded-xl bg-slate-800/50"><p className="text-sm text-slate-400 mb-2">{t.reports.recommendation}</p><p className="text-white">{forecast.recommendation}</p></div><div className="grid grid-cols-3 gap-4">{forecast.teamForecasts?.map(tf => <div key={tf.id} className="p-4 rounded-xl bg-slate-800/50"><div className="flex items-center gap-2 mb-2"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: tf.color }} /><span className="text-white font-medium">{tf.name}</span></div><div className="flex items-center justify-between text-sm"><span className="text-slate-400">Current: {tf.velocity}</span><span className={`font-bold ${tf.forecast.trend > 0 ? 'text-emerald-400' : tf.forecast.trend < 0 ? 'text-red-400' : 'text-slate-300'}`}>â†’ {tf.forecast.forecast} SP<Icon name={tf.forecast.trend >= 0 ? 'trendUp' : 'trendDown'} className="w-3 h-3 inline ml-1" /></span></div>{tf.forecast.factors?.slice(0, 2).map((f, i) => <p key={i} className={`text-xs mt-1 ${f.type === 'positive' ? 'text-emerald-400' : f.type === 'negative' ? 'text-red-400' : 'text-slate-400'}`}>â€¢ {f.label}</p>)}</div>)}</div></div> : <div className="text-center py-8 text-slate-400"><Icon name="ai" className="w-12 h-12 mx-auto mb-4 opacity-50" /><p>Click "{t.reports.runSimulation}" to generate AI forecasts</p></div>}</div><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><h3 className="font-semibold text-white mb-4">{t.reports.monteCarlo}</h3>{simulation ? <div className="space-y-6"><div className="grid grid-cols-4 gap-4"><div className="p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/30"><p className="text-xs text-emerald-400 uppercase">{t.reports.p50}</p><p className="text-2xl font-bold text-emerald-400">{simulation.p50} sprints</p></div><div className="p-4 rounded-xl bg-amber-500/10 border border-amber-500/30"><p className="text-xs text-amber-400 uppercase">{t.reports.p75}</p><p className="text-2xl font-bold text-amber-400">{simulation.p75} sprints</p></div><div className="p-4 rounded-xl bg-red-500/10 border border-red-500/30"><p className="text-xs text-red-400 uppercase">{t.reports.p90}</p><p className="text-2xl font-bold text-red-400">{simulation.p90} sprints</p></div><div className="p-4 rounded-xl bg-purple-500/10 border border-purple-500/30"><p className="text-xs text-purple-400 uppercase">Total SP</p><p className="text-2xl font-bold text-purple-400">{simulation.totalSP}</p></div></div><div><p className="text-sm text-slate-400 mb-2">Completion Forecast</p><div className="flex items-end gap-1 h-32">{simulation.histogram.map((bucket, i) => <div key={i} className="flex-1 group relative"><div className="w-full bg-gradient-to-t from-cyan-500 to-emerald-500 rounded-t" style={{ height: `${bucket.pct * 3}%` }} /><div className="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 hidden group-hover:block bg-slate-800 px-2 py-1 rounded text-xs whitespace-nowrap z-10">{bucket.sprints} sprints: {bucket.pct.toFixed(1)}%</div></div>)}</div><div className="flex justify-between mt-2 text-xs text-slate-500"><span>{simulation.min} sprints</span><span>{simulation.max} sprints</span></div></div></div> : <div className="text-center py-12 text-slate-400"><Icon name="reports" className="w-12 h-12 mx-auto mb-4 opacity-50" /><p>Click "{t.reports.runSimulation}" to generate Monte Carlo simulation</p></div>}</div></div>; };

const PortfolioView = () => { const { t, arts, teams, items, sprints, dependencies } = useApp(); const portfolioData = useMemo(() => { return arts.map(art => { const artTeams = teams.filter(tm => art.teamIds?.includes(tm.id) || tm.artId === art.id); const artItems = items.filter(i => artTeams.some(tm => tm.id === i.teamId) || i.artId === art.id); let totalCap = 0, totalDemand = 0; artTeams.forEach(team => { sprints.forEach(sprint => { totalCap += sprint.isIP ? team.velocity * 0.2 : team.velocity; }); }); totalDemand = artItems.reduce((sum, i) => sum + (i.sp || 0), 0); const forecast = AIForecastEngine.forecastART(artTeams); return { ...art, teams: artTeams, items: artItems, totalCap, totalDemand, load: totalCap > 0 ? totalDemand / totalCap : 0, forecast }; }); }, [arts, teams, items, sprints]); const totalCap = portfolioData.reduce((sum, a) => sum + a.totalCap, 0); const totalDemand = portfolioData.reduce((sum, a) => sum + a.totalDemand, 0); const crossARTDeps = dependencies?.filter(d => d.crossART) || []; const suggestion = useMemo(() => { const overloaded = portfolioData.find(a => a.load > 0.9); const underloaded = portfolioData.find(a => a.load < 0.7); if (overloaded && underloaded) { const diff = Math.round((overloaded.load - underloaded.load) * overloaded.totalCap * 0.1); return { from: overloaded.name, to: underloaded.name, sp: diff }; } return null; }, [portfolioData]); return <div className="space-y-6"><div><h2 className="text-2xl font-bold text-white">{t.portfolio.title}</h2><p className="text-slate-400">{t.portfolio.subtitle}</p></div><div className="grid grid-cols-4 gap-4"><Stat label="ARTs" value={portfolioData.length} color="purple" /><Stat label={t.portfolio.totalCapacity} value={`${totalCap} SP`} color="cyan" /><Stat label={t.portfolio.totalDemand} value={`${totalDemand} SP`} color="purple" /><Stat label="Load" value={`${totalCap > 0 ? ((totalDemand / totalCap) * 100).toFixed(0) : 0}%`} color={totalDemand / totalCap > 0.9 ? 'red' : 'emerald'} /></div>{suggestion && <div className="bg-gradient-to-r from-purple-500/10 to-cyan-500/10 border border-purple-500/30 rounded-xl p-4 flex items-center justify-between"><div className="flex items-center gap-3"><Icon name="ai" className="w-8 h-8 text-purple-400" /><div><p className="text-white font-medium">{t.portfolio.suggestion}</p><p className="text-sm text-slate-400">Move capacity from <strong>{suggestion.from}</strong> to <strong>{suggestion.to}</strong> ({suggestion.sp} SP)</p></div></div><button className="px-4 py-2 rounded-lg bg-purple-500/20 text-purple-400 hover:bg-purple-500/30">{t.portfolio.rebalance}</button></div>}<div className="grid grid-cols-1 lg:grid-cols-2 gap-6">{portfolioData.map(art => { const color = getLoadColor(art.load); return <div key={art.id} className="bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden"><div className="p-4 border-b border-slate-700" style={{ borderLeftWidth: 4, borderLeftColor: art.color }}><div className="flex items-center justify-between"><h3 className="font-semibold text-white">{art.name}</h3><Badge variant={art.load > 0.9 ? 'danger' : art.load > 0.8 ? 'warning' : 'success'}>{(art.load * 100).toFixed(0)}%</Badge></div><p className="text-sm text-slate-400">{art.teams.length} teams â€¢ {art.items.length} items</p></div><div className="p-4 space-y-4"><div className="flex justify-between text-sm"><div><span className="text-slate-400">Capacity:</span> <span className="text-white font-medium">{art.totalCap} SP</span></div><div><span className="text-slate-400">Demand:</span> <span className="text-white font-medium">{art.totalDemand} SP</span></div><div><span className="text-slate-400">Reserve:</span> <span className={`font-medium ${art.totalCap - art.totalDemand >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>{art.totalCap - art.totalDemand} SP</span></div></div><div className="h-2 bg-slate-800 rounded-full overflow-hidden"><div className="h-full rounded-full" style={{ width: `${Math.min(art.load * 100, 100)}%`, backgroundColor: color.fill }} /></div><div className="grid grid-cols-3 gap-2">{art.teams.slice(0, 3).map(team => <div key={team.id} className="p-2 rounded-lg bg-slate-800/50 text-center"><div className="w-2 h-2 rounded-full mx-auto mb-1" style={{ backgroundColor: team.color }} /><p className="text-xs text-white truncate">{team.name}</p><p className="text-xs text-slate-400">{team.velocity} SP</p></div>)}</div>{art.forecast && <div className="p-3 rounded-lg bg-purple-500/10 border border-purple-500/30"><div className="flex items-center gap-2 text-sm"><Icon name="ai" className="w-4 h-4 text-purple-400" /><span className="text-slate-400">Next PI Forecast:</span><span className="text-purple-400 font-medium">{art.forecast.totalForecast} SP</span></div></div>}</div></div>; })}</div>{crossARTDeps.length > 0 && <div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><h3 className="font-semibold text-white mb-4 flex items-center gap-2"><Icon name="link" className="w-5 h-5" />{t.portfolio.crossART}</h3><div className="space-y-2">{crossARTDeps.map(dep => <div key={dep.id} className="p-3 rounded-lg bg-amber-500/10 border border-amber-500/30 flex items-center gap-3"><Icon name="link" className="w-5 h-5 text-amber-400" /><span className="text-white">{dep.description || 'Cross-ART dependency'}</span><Badge variant="warning">Cross-ART</Badge></div>)}</div></div>}</div>; };

const SettingsView = () => { const { t, auditLog, userRole } = useApp(); const [activeTab, setActiveTab] = useState('integrations'); const [jiraConfig, setJiraConfig] = useState({ url: '', token: '', project: '', connected: false }); const [alertConfig, setAlertConfig] = useState({ capacityOver: true, capacityWarn: true, lowConfidence: true, slack: false, teams: false, email: false, slackWebhook: '', teamsWebhook: '' }); const [autoSync, setAutoSync] = useState(false); const canImport = ROLES[userRole]?.canEdit; const testConnection = async () => { await new Promise(r => setTimeout(r, 1000)); setJiraConfig({ ...jiraConfig, connected: true }); }; const testAlert = (channel) => { alert(`Test notification sent to ${channel}`); }; return <div className="space-y-6"><h2 className="text-2xl font-bold text-white">{t.settings.title}</h2><div className="flex gap-2 border-b border-slate-800 pb-2">{['integrations', 'alerts', 'audit'].map(tab => <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 rounded-lg text-sm font-medium ${activeTab === tab ? 'bg-cyan-500/20 text-cyan-300' : 'text-slate-400 hover:text-white'}`}>{tab === 'integrations' && 'ðŸ”— ' + t.settings.integrations}{tab === 'alerts' && 'ðŸ”” ' + t.settings.alerts}{tab === 'audit' && 'ðŸ“‹ ' + t.settings.audit}</button>)}</div>{activeTab === 'integrations' && canImport && <div className="space-y-6"><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><div className="flex items-center justify-between mb-4"><h3 className="font-semibold text-white flex items-center gap-2">ðŸ”· Jira Cloud â€” Bidirectional Sync</h3>{jiraConfig.connected && <Badge variant="success">{t.settings.connected}</Badge>}</div><div className="grid grid-cols-3 gap-4 mb-4"><div><label className="block text-xs text-slate-400 mb-1">Jira URL</label><input type="text" value={jiraConfig.url} onChange={e => setJiraConfig({ ...jiraConfig, url: e.target.value })} placeholder="https://company.atlassian.net" className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm" /></div><div><label className="block text-xs text-slate-400 mb-1">API Token</label><input type="password" value={jiraConfig.token} onChange={e => setJiraConfig({ ...jiraConfig, token: e.target.value })} className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm" /></div><div><label className="block text-xs text-slate-400 mb-1">Project Key</label><input type="text" value={jiraConfig.project} onChange={e => setJiraConfig({ ...jiraConfig, project: e.target.value })} placeholder="PROJ" className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm" /></div></div><div className="flex flex-wrap gap-2"><button onClick={testConnection} className="px-3 py-1.5 rounded-lg bg-slate-700 text-white text-sm">{t.settings.testConnection}</button>{jiraConfig.connected && <><button className="px-3 py-1.5 rounded-lg bg-cyan-500/20 text-cyan-400 text-sm flex items-center gap-2"><Icon name="sync" className="w-4 h-4" />{t.settings.syncNow}</button><label className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-700 text-white text-sm cursor-pointer"><input type="checkbox" checked={autoSync} onChange={e => setAutoSync(e.target.checked)} />{t.settings.autoSync}</label></>}</div></div><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><h3 className="font-semibold text-white mb-4 flex items-center gap-2">ðŸ”¶ Azure DevOps</h3><div className="grid grid-cols-3 gap-4 mb-4"><div><label className="block text-xs text-slate-400 mb-1">Organization URL</label><input type="text" placeholder="https://dev.azure.com/org" className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm" /></div><div><label className="block text-xs text-slate-400 mb-1">PAT Token</label><input type="password" className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm" /></div><div><label className="block text-xs text-slate-400 mb-1">Project</label><input type="text" className="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm" /></div></div><button className="px-3 py-1.5 rounded-lg bg-slate-700 text-white text-sm">{t.settings.testConnection}</button></div></div>}{activeTab === 'alerts' && <div className="space-y-6"><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6"><h3 className="font-semibold text-white mb-4">Notification Channels</h3><div className="grid grid-cols-3 gap-4">{['slack', 'teams', 'email'].map(channel => <div key={channel} className="p-4 rounded-xl bg-slate-800/50"><div className="flex items-center gap-2 mb-3"><span className="text-xl">{channel === 'slack' ? 'ðŸ’¬' : channel === 'teams' ? 'ðŸ‘¥' : 'ðŸ“§'}</span><span className="font-medium text-white capitalize">{channel}</span><input type="checkbox" checked={alertConfig[channel]} onChange={e => setAlertConfig({ ...alertConfig, [channel]: e.target.checked })} className="ml-auto" /></div><input type="text" value={alertConfig[`${channel}Webhook`] || ''} onChange={e => setAlertConfig({ ...alertConfig, [`${channel}Webhook`]: e.target.value })} placeholder={t.settings.webhook} className="w-full px-3 py-2 rounded-lg bg-slate-700 border border-slate-600 text-white text-sm mb-2" /><button onClick={() => testAlert(channel)} className="text-xs text-cyan-400 hover:underline">{t.settings.testAlert}</button></div>)}</div></div></div>}{activeTab === 'audit' && <div className="bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden"><table className="w-full"><thead><tr className="bg-slate-900 text-xs uppercase text-slate-400"><th className="px-4 py-3 text-left">Timestamp</th><th className="px-4 py-3 text-left">User</th><th className="px-4 py-3 text-left">Action</th><th className="px-4 py-3 text-left">Details</th></tr></thead><tbody className="divide-y divide-slate-800">{auditLog.map(log => <tr key={log.id} className="hover:bg-slate-800/30"><td className="px-4 py-3 text-sm text-slate-400">{new Date(log.timestamp).toLocaleString()}</td><td className="px-4 py-3 text-sm text-white">{log.user}</td><td className="px-4 py-3"><Badge variant={log.action === 'created' ? 'success' : log.action === 'updated' ? 'warning' : 'danger'}>{log.action}</Badge></td><td className="px-4 py-3 text-sm text-slate-300">{log.details}</td></tr>)}</tbody></table></div>}</div>; };

export default function App() {
  const [user, setUser] = useState(null);
  const [userRole, setUserRole] = useState('rte');
  const [isDemo, setIsDemo] = useState(false);
  const [lang, setLang] = useState('pl');
  const [view, setView] = useState('dashboard');
  const [pi, setPi] = useState('PI44');
  const [arts, setArts] = useState([]);
  const [teams, setTeams] = useState([]);
  const [items, setItems] = useState([]);
  const [dependencies, setDependencies] = useState([]);
  const [risks, setRisks] = useState([]);
  const [absences, setAbsences] = useState({});
  const [milestones, setMilestones] = useState([]);
  const [auditLog, setAuditLog] = useState([]);
  const [selectedItem, setSelectedItem] = useState(null);

  const t = T[lang];
  const sprints = useMemo(() => calculateSprints(PI_CONFIG[pi]), [pi]);

  const handleDemo = (role, selectedLang) => {
    const demo = createDemoData();
    setArts(demo.arts);
    setTeams(demo.teams);
    setItems(demo.items);
    setDependencies(demo.dependencies);
    setRisks(demo.risks);
    setAbsences(demo.absences);
    setMilestones(demo.milestones);
    setAuditLog(demo.auditLog);
    setUserRole(role);
    setLang(selectedLang);
    setIsDemo(true);
    setUser({ email: 'demo@pi-planner.app', role });
  };

  const addAuditEntry = (action, entity, entityId, details) => setAuditLog(prev => [{ id: uid(), user: user?.email || 'system', action, entity, entityId, timestamp: new Date().toISOString(), details }, ...prev]);
  const updateTeam = (id, upd) => { setTeams(prev => prev.map(tm => tm.id === id ? { ...tm, ...upd } : tm)); addAuditEntry('updated', 'Team', id, Object.keys(upd).join(', ')); };
  const addTeam = (team) => { setTeams(prev => [...prev, team]); addAuditEntry('created', 'Team', team.id, team.name); };
  const deleteTeam = (id) => { setTeams(prev => prev.filter(tm => tm.id !== id)); addAuditEntry('deleted', 'Team', id, ''); };
  const updateItem = (id, upd) => { setItems(prev => prev.map(i => i.id === id ? { ...i, ...upd } : i)); addAuditEntry('updated', 'Item', id, Object.keys(upd).join(', ')); };
  const addItem = (item) => { setItems(prev => [...prev, item]); addAuditEntry('created', 'Item', item.id, item.name); };
  const deleteItem = (id) => { setItems(prev => prev.filter(i => i.id !== id)); addAuditEntry('deleted', 'Item', id, ''); };
  const addDependency = (dep) => { setDependencies(prev => [...prev, dep]); addAuditEntry('created', 'Dependency', dep.id, ''); };
  const deleteDependency = (id) => { setDependencies(prev => prev.filter(d => d.id !== id)); addAuditEntry('deleted', 'Dependency', id, ''); };
  const addRisk = (risk) => { setRisks(prev => [...prev, risk]); addAuditEntry('created', 'Risk', risk.id, risk.name); };
  const updateRisk = (id, upd) => { setRisks(prev => prev.map(r => r.id === id ? { ...r, ...upd } : r)); };
  const deleteRisk = (id) => { setRisks(prev => prev.filter(r => r.id !== id)); addAuditEntry('deleted', 'Risk', id, ''); };
  const updateAbsence = (teamId, memberId, sprint, days) => setAbsences(prev => ({ ...prev, [`${teamId}-${memberId}-${sprint}`]: days }));

  const ctx = { t, lang, setLang, arts, teams, setTeams, items, sprints, absences, milestones, dependencies, risks, auditLog, pi, setPi, userRole, user, isDemo, selectedItem, setSelectedItem, updateTeam, addTeam, deleteTeam, updateItem, addItem, deleteItem, addDependency, deleteDependency, addRisk, updateRisk, deleteRisk, updateAbsence, addAuditEntry };

  if (!user && !isDemo) return <AuthScreen onDemo={handleDemo} />;

  const navItems = [
    { id: 'dashboard', icon: 'dashboard', label: t.nav.dashboard },
    { id: 'capacity', icon: 'capacity', label: t.nav.capacity },
    { id: 'backlog', icon: 'backlog', label: t.nav.backlog },
    { id: 'teams', icon: 'teams', label: t.nav.teams },
    { id: 'program', icon: 'program', label: t.nav.program },
    { id: 'dependencies', icon: 'link', label: t.nav.dependencies },
    { id: 'whatif', icon: 'whatif', label: t.nav.whatif },
    { id: 'risks', icon: 'risks', label: t.nav.risks },
    { id: 'reports', icon: 'reports', label: t.nav.reports },
    { id: 'portfolio', icon: 'portfolio', label: t.nav.portfolio },
    { id: 'settings', icon: 'settings', label: t.nav.settings }
  ];

  const views = { dashboard: RTEDashboard, capacity: CapacityBoard, backlog: BacklogView, teams: TeamsView, program: ProgramBoard, dependencies: DependenciesView, whatif: WhatIfView, risks: RisksView, reports: ReportsView, portfolio: PortfolioView, settings: SettingsView };
  const ViewComponent = views[view] || RTEDashboard;

  return (
    <AppContext.Provider value={ctx}>
      <div className="min-h-screen bg-slate-950 text-slate-100" style={{ fontFamily: "'Inter', system-ui, sans-serif" }}>
        <style>{`@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');`}</style>
        <header className="bg-slate-900/80 backdrop-blur-lg border-b border-slate-800 sticky top-0 z-40">
          <div className="max-w-[1800px] mx-auto px-6 py-4 flex items-center justify-between">
            <div className="flex items-center gap-4"><div className="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-cyan-500/20"><span className="text-xl font-bold text-white">Ï€</span></div><div><h1 className="text-lg font-semibold text-white">{t.app.title}</h1><p className="text-xs text-slate-400">{t.app.subtitle}</p></div></div>
            <div className="flex items-center gap-4"><select value={pi} onChange={e => setPi(e.target.value)} className="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm">{Object.entries(PI_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.name}</option>)}</select><div className="flex gap-1 p-1 rounded-lg bg-slate-800"><button onClick={() => setLang('en')} className={`px-2 py-1 rounded text-xs ${lang === 'en' ? 'bg-cyan-500/20 text-cyan-300' : 'text-slate-400'}`}>EN</button><button onClick={() => setLang('pl')} className={`px-2 py-1 rounded text-xs ${lang === 'pl' ? 'bg-cyan-500/20 text-cyan-300' : 'text-slate-400'}`}>PL</button></div><Badge variant={userRole === 'admin' ? 'danger' : userRole === 'rte' ? 'purple' : 'default'}>{t.auth[userRole]}</Badge>{isDemo && <Badge variant="warning">DEMO</Badge>}<button onClick={() => { setUser(null); setIsDemo(false); }} className="text-sm text-slate-400 hover:text-red-400">{t.auth.signOut}</button></div>
          </div>
        </header>
        <div className="max-w-[1800px] mx-auto flex">
          <nav className="w-52 shrink-0 p-4 sticky top-20 h-[calc(100vh-80px)]"><div className="space-y-1">{navItems.map(item => <button key={item.id} onClick={() => setView(item.id)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all ${view === item.id ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-300' : 'text-slate-400 hover:text-white hover:bg-slate-800/50'}`}><Icon name={item.icon} className="w-5 h-5" /><span>{item.label}</span></button>)}</div></nav>
          <main className="flex-1 p-6 min-h-[calc(100vh-80px)]"><ViewComponent /></main>
        </div>
        {selectedItem && <ItemDetailModal item={selectedItem} onClose={() => setSelectedItem(null)} />}
      </div>
    </AppContext.Provider>
  );
}
